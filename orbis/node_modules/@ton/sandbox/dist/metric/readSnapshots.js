"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.readSnapshots = void 0;
const path_1 = require("path");
const fs_1 = require("fs");
async function readSnapshots(snapshotDir) {
    const list = {};
    if (!(0, fs_1.existsSync)(snapshotDir)) {
        return list;
    }
    const snapshotFiles = (0, fs_1.readdirSync)(snapshotDir).filter((f) => f.endsWith('.json'));
    for (const snapshotFile of snapshotFiles) {
        const data = (0, fs_1.readFileSync)((0, path_1.join)(snapshotDir, snapshotFile), 'utf-8');
        try {
            const raw = JSON.parse(data);
            const snapshot = {
                ...raw,
                createdAt: new Date(raw.createdAt),
            };
            if (!list[snapshot.label]) {
                list[snapshot.label] = {
                    name: snapshotFile,
                    content: snapshot,
                };
            }
        }
        catch (_) {
            throw new Error(`Can not parse snapshot file: ${snapshotFile}`);
        }
    }
    return list;
}
exports.readSnapshots = readSnapshots;
